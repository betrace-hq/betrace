# Architecture Guardian Analysis Request

**architecture-guardian:** Review FLUO's architectural completeness and identify gaps that need PRDs.

## Analysis Required

### 1. ADR Compliance Audit
Review all ADRs in docs/adrs/ and verify implementation:
- **ADR-011 (Pure Application Framework)** - Is deployment truly external? Any violations?
- **ADR-006 (Tanstack Frontend)** - Is Tanstack Router fully implemented?
- **ADR-002 (Nix Flakes)** - Are builds reproducible? Supply chain secure?
- **ADR-015 (Development Workflow)** - Are quality standards enforced?

For deferred ADRs (012, 013, 014):
- Should they be implemented or deleted?
- Do they conflict with current direction?

### 2. System Architecture Gaps
**Core Components:**
- [ ] OpenTelemetry span ingestion (working?)
- [ ] DSL parser â†’ Drools compilation (implemented?)
- [ ] Rule engine execution (per-tenant sessions?)
- [ ] Signal generation and storage (database? in-memory?)
- [ ] Compliance span generation (working?)
- [ ] Trace correlation (how are traces assembled?)

**Missing Components:**
- [ ] Persistence layer (what database? how's data stored?)
- [ ] Message queue (NATS mentioned in ADR-007 - implemented?)
- [ ] Caching layer (needed for performance?)
- [ ] Background job processing (rule evaluation async?)
- [ ] Webhook/notification system (how are signals delivered?)

### 3. Integration Points
**External Systems:**
- [ ] OpenTelemetry Collector integration (configured?)
- [ ] Grafana/Tempo query integration (can users click through?)
- [ ] WorkOS authentication (backend implementation?)
- [ ] KMS for encryption keys (which provider?)
- [ ] Object storage for traces (S3? local?)
- [ ] Email/Slack for notifications (configured?)

### 4. Scalability Architecture
**Current Limitations:**
- In-memory Drools sessions (what happens at scale?)
- No distributed tracing of FLUO itself
- Single-instance Tempo/Grafana in dev (production story?)
- No horizontal scaling strategy
- No rate limiting or backpressure

**Questions:**
- Can FLUO handle 1M spans/second?
- How many concurrent tenants?
- What's the rule engine memory footprint?
- Are there circuit breakers?

### 5. Data Model & Schema
**Missing Definitions:**
- Signal schema (what fields? how stored?)
- Rule schema (version control? migration strategy?)
- Tenant schema (what metadata? billing info?)
- Compliance evidence schema (export format?)
- Trace storage strategy (retention policy?)

### 6. Configuration Management
- How are rules deployed (API? GitOps?)
- How are tenants configured (admin UI? API?)
- Environment-specific config (dev/staging/prod)
- Feature flags (gradual rollout?)

## Output Format

For each architectural gap:
1. **Gap Title** - Component or decision missing
2. **Current State** - What exists (file paths, partial implementations)
3. **Architectural Impact** - Why this matters for system integrity
4. **Required Work** - What needs to be built/decided
5. **ADR Reference** - Which ADR covers this (or needs new ADR)
6. **Priority** - P0/P1/P2 based on architectural risk
7. **Complexity** - Simple/Medium/Complex
8. **Dependencies** - What else must exist first

Focus on gaps that could cause architectural rework later. Better to decide now than refactor in production.
